{% extends "users/__base__.html" %}
{% load static %}
{% block title %} 
Rejoignez-nous{% endblock title %}
{%block content %} 
{% if request.user.is_authenticated %}
<script>
  location.href = "{% url 'homepage' %}"
</script>
{% endif %}
<form action="" method="POST" id='form'>{% csrf_token %}
  <div class="card">
    <div class="text-center intro">
       <img src="https://i.ibb.co/yVGxFPR/2.png" width="160">
       </div>
    <div class="mt-4 text-center">
        <h4 class="mt-3">Inscription </h4> <br>
              <div class="alert alert-success d-none" id="msg">
                <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                 <strong id="imgs">Votre Compte à été bien créer. connectez vous</strong> 
              </div>
              <div class="alert alert-danger d-none" id="error">
                <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                 <strong id="ierror"></strong> 
              </div>
        <div class="mt-3 inputbox"> {{form.first_name}} <i class="fa fa-user"></i> </div>
        <div class="inputbox"> {{form.username}} <i class="fa fa-user"></i> </div>
        <div class="inputbox"> {{form.email}} <i class="fa fa-envelope-o"></i> </div>
        <div class="inputbox"> {{form.password1}} <i class="fa fa-lock"></i> </div>
        <div class="inputbox"> {{form.password2}} <i class="fa fa-lock"></i> </div>
    </div>
  
    <div class="d-flex justify-content-between">
        <div> <a href="{% url 'login' %}" class="forgot">déja un compte</a> </div>
    </div>
    <div class="mt-2">
      <button class="btn btn-primary btn-block btn" type="submit">S'inscrire</button> </div>
    </div>
  
  </form>

{%endblock %}

{% block javascript%}
<script>
  document.querySelector("#form").addEventListener("submit", (e)=>{
    e.preventDefault()
    if(!document.querySelector("#error").classList.contains("d-none")){
      document.querySelector("#error").classList.add("d-none");
    }
    if(!document.querySelector("#msg").classList.contains("d-none")){
      document.querySelector("#msg").classList.add("d-none");
    }
    document.querySelector(".btn").textContent = "Creation encoure ..."
    $.ajax({
            type: "POST",
            url: "{% url 'newuser' %}",
            data: $("#form").serialize(),
            datatype: "json",
            success: function(data) {
                if (data.success === "success") {
                   document.querySelector("#msg").classList.remove("d-none");
                   document.querySelector(".btn").textContent = "Terminer"
                }else{
                  if(data.username){
                    document.querySelector("#ierror").innerHTML = data.username
                  }else if(data.email){
                    document.querySelector("#ierror").innerHTML = data.email
                  }else{
                    document.querySelector("#ierror").innerHTML = data.password2
                  }
      
                  document.querySelector("#error").classList.remove("d-none");
                  document.querySelector(".btn").textContent = "Erreur"
                }
            }
        })
  })
   
</script>
{%endblock%}